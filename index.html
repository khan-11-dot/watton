<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Admin Login - Watton Tobacco</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet"/>
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet"/>
<link href="../css/style.css" rel="stylesheet"/>
<link href="../css/navigation.css" rel="stylesheet"/>
<!-- Add SheetJS library -->
<script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
<style>
        body { background-color: #f8f9fa; }
        .page-header {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: white;
            text-align: center;
            padding: 3rem 0;
            margin-bottom: 2rem;
        }
        .login-container {
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            padding: 2rem;
            margin-top: 2rem;
            margin-bottom: 3rem;
        }
        .form-label {
            color: #2a5298;
            font-weight: 500;
        }
        .form-control:focus {
            border-color: #2a5298;
            box-shadow: 0 0 0 0.2rem rgba(42, 82, 152, 0.25);
        }
        .btn-primary {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            border: none;
            padding: 0.5rem 2rem;
        }
        .btn-primary:hover {
            background: linear-gradient(135deg, #2a5298 0%, #1e3c72 100%);
            transform: translateY(-1px);
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .login-title {
            color: #1e3c72;
            text-align: center;
            margin-bottom: 2rem;
            font-weight: 600;
        }
        .alert {
            border-radius: 8px;
            margin-bottom: 1.5rem;
        }
        .admin-dashboard {
            background-color: #f8f9fa;
            padding-top: 2rem;
        }
        .card {
            border: none;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            background: white;
        }
        .card-title {
            color: #1e3c72;
            font-weight: 600;
            font-size: 1.5rem;
        }
        .stat-card {
            background: linear-gradient(135deg, #ffffff 0%, #f8f9fa 100%);
            border-radius: 8px;
            padding: 1.5rem;
            transition: all 0.3s ease;
        }
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
        }
        .stat-card i {
            color: #2a5298;
            margin-bottom: 1rem;
        }
        .stat-card h3 {
            color: #1e3c72;
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            font-weight: 600;
        }
        .stat-card p {
            color: #2a5298;
            font-weight: bold;
            margin: 0;
        }
        .activity-item {
            transition: all 0.3s ease;
            padding: 0.5rem;
            border-bottom: 1px solid #dee2e6;
        }
        .activity-item:hover {
            background-color: #f8f9fa;
            transform: translateX(5px);
        }
        #adminDashboard { display: none; }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
            max-width: 350px;
        }
        .check-in, .check-out {
            background-color: #f8f9fa;
            color: #000;
            font-weight: 500;
            border: 1px solid #dee2e6;
        }
        
        .check-in:disabled, .check-out:disabled {
            background-color: #f8f9fa;
            color: #000;
            opacity: 1;
            cursor: not-allowed;
        }

        .working-hours {
            font-weight: 500;
            color: #000;
        }
    </style>
</head>
<body>
<!-- Navigation -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark fixed-top">
<div class="container">
<a class="navbar-brand" href="../index.html">Watton Tobacco</a>
<button class="navbar-toggler" data-bs-target="#navbarNav" data-bs-toggle="collapse" type="button">
<span class="navbar-toggler-icon"></span>
</button>
<div class="collapse navbar-collapse" id="navbarNav">
<ul class="navbar-nav">
<li class="nav-item">
<a class="nav-link" href="../index.html">Home</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../hand-stem.html">Hand Stem</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../labor-registration.html">Labor Registration</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../staff-apply.html">Apply for Staff</a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" id="warehousesLink">Warehouses</a>
</li>
<li class="nav-item">
<a class="nav-link" href="#" id="centersLink">Purchase Centers</a>
</li>
<li class="nav-item">
<a class="nav-link active" href="../admin/index.html">Admin</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../staff/index.html">Staff</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../creator.html">Developer</a>
</li>
<li class="nav-item">
<a class="nav-link" href="../contact.html">Contact</a>
</li>
</ul>
</div>
</div>
</nav>

<!-- Warehouses List -->
    <div class="location-list d-none" id="warehousesList">
<div class="container">
<div class="row">
<div class="col-12">
<h2>Warehouses</h2>
<div class="list-group">
<a class="list-group-item" href="../warehouses/ismaila.html">
<i class="fas fa-warehouse"></i> Ismaila Warehouse
                        </a>
<a class="list-group-item" href="../warehouses/mansabdar.html">
<i class="fas fa-warehouse"></i> Mansabdar Warehouse
                        </a>
</div>
</div>
</div>
</div>
</div>
</div>

<!-- Purchase Centers List -->
    <div class="location-list d-none" id="centersList">
<div class="container">
<div class="row">
<div class="col-12">
<h2>Purchase Centers</h2>
<div class="list-group">
<a class="list-group-item" href="../centers/sher-garh.html">
<i class="fas fa-store"></i> Sher Garh Center
                        </a>
<a class="list-group-item" href="../centers/maira.html">
<i class="fas fa-store"></i> Maira Center
                        </a>
<a class="list-group-item" href="../centers/aman-abad.html">
<i class="fas fa-store"></i> Aman Abad Center
                        </a>
<a class="list-group-item" href="../centers/bunir.html">
<i class="fas fa-store"></i> Bunir Center
                        </a>
</div>
</div>
</div>
</div>
</div>

<!-- Login Form -->
    <div class="container mt-5 pt-4" id="loginForm">
<div class="row justify-content-center">
<div class="col-md-6">
<div class="login-container">
                    <h2 class="login-title">Admin Login</h2>
                    <div class="alert alert-danger d-none" id="loginError">
                        Invalid username or password!
                    </div>
                    <form onsubmit="event.preventDefault(); validateLogin();">
<div class="mb-3">
                            <label class="form-label" for="username">Username</label>
                            <input class="form-control" id="username" required type="text"/>
</div>
<div class="mb-3">
                            <label class="form-label" for="password">Password</label>
                            <input class="form-control" id="password" required type="password"/>
</div>
<div class="mb-3 form-check">
<input class="form-check-input" id="rememberMe" type="checkbox"/>
<label class="form-check-label" for="rememberMe">Remember me</label>
</div>
                        <button class="btn btn-primary w-100" type="submit">Login</button>
</form>
</div>
</div>
</div>
</div>

    <!-- Admin Dashboard -->
    <div class="container mt-5 pt-4" id="adminDashboard">
<!-- Quick Stats -->
        <div class="row mb-4">
<div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-users fa-2x"></i>
<h3>Total Workers</h3>
                    <p>150</p>
</div>
</div>
<div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-clock fa-2x"></i>
                    <h3>Pending Requests</h3>
                    <p id="dashboardPendingCount">2</p>
</div>
</div>
<div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-warehouse fa-2x"></i>
                    <h3>Warehouses</h3>
                    <p>2</p>
</div>
</div>
<div class="col-md-3">
                <div class="stat-card">
                    <i class="fas fa-box fa-2x"></i>
<h3>Total Stock</h3>
                    <p>5000 kg</p>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Quick Actions</h5>
                        <div class="d-flex flex-wrap gap-2">
                            <button class="btn btn-primary" onclick="showPendingRegistrations()">
                                View Pending Registrations <span class="badge bg-light text-dark ms-2" id="pendingCount">2</span>
                            </button>
                            <button class="btn btn-primary" onclick="showAttendanceModal()">
                                View Attendance
                            </button>
                            <button class="btn btn-primary" onclick="showAttendanceRecords()">
                                <i class="fas fa-file-alt"></i> Attendance Records
                            </button>
                            <button class="btn btn-primary" onclick="showRegistrations()">
                                <i class="fas fa-list"></i> View All Registrations
                            </button>
                            <button class="btn btn-primary" onclick="window.location.href='payments.html'">
                                <i class="fas fa-money-bill-wave"></i> Payments & Wages
                            </button>
                            <button class="btn btn-primary" onclick="showChangePassword()">
                                Change Password
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Registrations Section -->
        <div class="row mt-4 d-none" id="registrationsSection">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">All Registrations</h5>
                        <div class="row mb-3">
                            <div class="col-md-4">
                                <select class="form-select" id="registrationType">
                                    <option value="all">All Registrations</option>
                                    <option value="labor">Labor Registrations</option>
                                    <option value="staff">Staff Applications</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <select class="form-select" id="registrationStatus">
                                    <option value="all">All Status</option>
                                    <option value="pending">Pending</option>
                                    <option value="accepted">Accepted</option>
                                    <option value="rejected">Rejected</option>
                                </select>
                            </div>
                            <div class="col-md-4">
                                <div class="input-group">
                                    <input type="text" class="form-control" id="searchRegistrations" placeholder="Search...">
                                    <button class="btn btn-outline-primary" type="button">
                                        <i class="fas fa-search"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                        <div class="table-responsive">
                            <table class="table table-hover">
                                <thead>
                                    <tr>
                                        <th>Date</th>
                                        <th>Name</th>
                                        <th>Type</th>
                                        <th>CNIC</th>
                                        <th>Status</th>
                                        <th>Actions</th>
                                    </tr>
                                </thead>
                                <tbody id="registrationsTableBody">
                                    <!-- Data will be loaded here -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Activity -->
        <div class="row">
            <div class="col-12">
                <div class="card">
                    <div class="card-body">
                        <h5 class="card-title">Recent Activity</h5>
                        <div id="recentActivityList">
                            <div class="activity-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>New worker registration: Muhammad Ali</span>
                                    <small class="text-muted">10:30 AM</small>
                                </div>
                            </div>
                            <div class="activity-item">
                                <div class="d-flex justify-content-between align-items-center">
                                    <span>Stock updated at Ismaila Warehouse</span>
                                    <small class="text-muted">09:15 AM</small>
                                </div>
                            </div>
</div>
</div>
</div>
</div>
</div>

    <!-- Attendance Records Section -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Attendance Records</h5>
                    <div class="row mb-3">
                        <div class="col-md-4">
                            <label class="form-label">Select Month</label>
                            <input type="month" class="form-control" id="monthSelector" onchange="loadMonthlyAttendance()">
                        </div>
                        <div class="col-md-8 text-end">
                            <button class="btn btn-primary" onclick="exportToExcel()">
                                <i class="fas fa-file-excel"></i> Export to Excel
                            </button>
                        </div>
                    </div>
                    <div class="table-responsive">
                        <table class="table table-bordered" id="monthlyAttendanceTable">
                            <thead class="table-light">
                                <tr>
                                    <th>Date</th>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                    <th>Status</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Working Hours</th>
                                </tr>
                            </thead>
                            <tbody id="monthlyAttendanceBody">
                                <!-- Data will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Monthly Summary Section -->
    <div class="row mt-4 mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">Monthly Summary</h5>
                    <div class="row" id="monthlySummaryContainer">
                        <!-- Summary cards will be generated here -->
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

    <!-- Pending Registrations Modal -->
    <div class="modal fade" id="pendingRegistrationsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Pending Labor Registrations</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>CNIC</th>
                                    <th>Age</th>
                                    <th>Experience</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="pendingRegistrationsTable">
                                <!-- Labor Registrations -->
                                <tr>
                                    <td>Muhammad Ali</td>
                                    <td>35202-1234567-8</td>
                                    <td>28</td>
                                    <td>5 years</td>
                                    <td><span class="badge bg-warning">Pending</span></td>
                                    <td>
                                        <button class="btn btn-info btn-sm" onclick="viewLaborDetails(this)">View Details</button>
                                        <button class="btn btn-success btn-sm" onclick="acceptLabor(this)">Accept</button>
                                        <button class="btn btn-danger btn-sm" onclick="rejectLabor(this)">Reject</button>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Staff Applications Table -->
                    <h5 class="mt-4">Staff Applications</h5>
                    <div class="table-responsive">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Name</th>
                                    <th>Position</th>
                                    <th>Education</th>
                                    <th>Experience</th>
                                    <th>Status</th>
                                    <th>Actions</th>
                                </tr>
                            </thead>
                            <tbody id="staffApplicationsTable">
                                <!-- Staff applications will be loaded here -->
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Labor Details Modal -->
    <div class="modal fade" id="laborDetailsModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Labor Details</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Personal Information -->
                    <h6 class="mb-3">Personal Information</h6>
                    <table class="table">
                        <tr>
                            <th>Full Name:</th>
                            <td id="laborName"></td>
                            <th>CNIC:</th>
                            <td id="laborCNIC"></td>
                        </tr>
                        <tr>
                            <th>Age:</th>
                            <td id="laborAge"></td>
                            <th>Gender:</th>
                            <td id="laborGender"></td>
                        </tr>
                        <tr>
                            <th>Marital Status:</th>
                            <td id="laborMaritalStatus"></td>
                            <th>Education:</th>
                            <td id="laborEducation"></td>
                        </tr>
                    </table>

                    <!-- Work Experience -->
                    <h6 class="mb-3 mt-4">Work Experience</h6>
                    <table class="table">
                        <tr>
                            <th>Experience:</th>
                            <td id="laborExperience"></td>
                            <th>Skills:</th>
                            <td id="laborSkills"></td>
                        </tr>
                        <tr>
                            <th>Previous Work:</th>
                            <td colspan="3" id="laborPreviousWork"></td>
                        </tr>
                    </table>

                    <!-- Additional Information -->
                    <h6 class="mb-3 mt-4">Additional Information</h6>
                    <table class="table">
                        <tr>
                            <th>Languages:</th>
                            <td id="laborLanguages"></td>
                            <th>Health Status:</th>
                            <td id="laborHealth"></td>
                        </tr>
                    </table>

                    <!-- Emergency Contact -->
                    <h6 class="mb-3 mt-4">Emergency Contact</h6>
                    <table class="table">
                        <tr>
                            <th>Name:</th>
                            <td id="emergencyName"></td>
                            <th>Relation:</th>
                            <td id="emergencyRelation"></td>
                        </tr>
                    </table>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-success" onclick="acceptLabor(this)">Accept</button>
                    <button type="button" class="btn btn-danger" onclick="rejectLabor(this)">Reject</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Accept Confirmation Modal -->
    <div class="modal fade" id="acceptConfirmationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <h5 class="modal-title text-white">Confirm Action</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <i class="fas fa-question-circle text-primary fa-3x mb-3"></i>
                    <h4 class="mb-3 text-dark">Accept Labor Registration?</h4>
                    <p class="mb-0 text-dark">Are you sure you want to accept this labor registration? This action cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center border-0 pt-0">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary px-4" id="confirmAcceptBtn">Accept</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Reject Confirmation Modal -->
    <div class="modal fade" id="rejectConfirmationModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-danger">
                    <h5 class="modal-title text-white">Confirm Action</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body text-center p-4">
                    <i class="fas fa-exclamation-circle text-danger fa-3x mb-3"></i>
                    <h4 class="mb-3 text-dark">Reject Labor Registration?</h4>
                    <p class="mb-0 text-dark">Are you sure you want to reject this labor registration? This action cannot be undone.</p>
                </div>
                <div class="modal-footer justify-content-center border-0 pt-0">
                    <button type="button" class="btn btn-secondary px-4" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-danger px-4" id="confirmRejectBtn">Reject</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Change Password Modal -->
    <div class="modal fade" id="changePasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <h5 class="modal-title text-white">Change Admin Password</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-4">
                    <div class="alert alert-danger d-none" id="passwordError">
                        Current password is incorrect!
                    </div>
                    <div class="alert alert-danger d-none" id="passwordMismatch">
                        New passwords do not match!
                    </div>
                    <form id="changePasswordForm" onsubmit="event.preventDefault(); changePassword();">
                        <div class="mb-3">
                            <label class="form-label" for="currentPassword">Current Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="currentPassword" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('currentPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label" for="newPassword">New Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="newPassword" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('newPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="mb-4">
                            <label class="form-label" for="confirmPassword">Confirm New Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="confirmPassword" required>
                                <button class="btn btn-outline-secondary" type="button" onclick="togglePassword('confirmPassword')">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                        </div>
                        <div class="d-grid">
                            <button type="submit" class="btn btn-primary">Change Password</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Attendance Modal -->
    <div class="modal fade" id="attendanceModal" tabindex="-1">
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header bg-primary">
                    <h5 class="modal-title text-white">Staff Attendance Management</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <!-- Date Selection and Controls -->
                    <div class="row mb-4">
                        <div class="col-md-4">
                            <div class="input-group">
                                <span class="input-group-text"><i class="fas fa-calendar"></i></span>
                                <input type="date" class="form-control" id="attendanceDate" onchange="loadAttendance()">
                            </div>
                        </div>
                        <div class="col-md-8 text-end">
                            <button class="btn btn-outline-primary" onclick="markAllPresent()">
                                <i class="fas fa-check-double"></i> Mark All Present
                            </button>
                            <button class="btn btn-outline-secondary" onclick="resetAttendance()">
                                <i class="fas fa-redo"></i> Reset
                            </button>
                            <button class="btn btn-success" onclick="saveAttendance()">
                                <i class="fas fa-save"></i> Save Attendance
                            </button>
                        </div>
                    </div>

                    <!-- Attendance Table -->
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead class="table-light">
                                <tr>
                                    <th>Employee ID</th>
                                    <th>Name</th>
                                    <th>Status</th>
                                    <th>Check In</th>
                                    <th>Check Out</th>
                                    <th>Working Hours</th>
                                </tr>
                            </thead>
                            <tbody id="attendanceTableBody">
                                <!-- Staff Members -->
                                <tr>
                                    <td>EMP001</td>
                                    <td>Shah Nazar Khan</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP002</td>
                                    <td>Masood Shah</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP003</td>
                                    <td>Sajjad Khan</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP004</td>
                                    <td>Raj Wali Khan</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP005</td>
                                    <td>Bakht Zada</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP006</td>
                                    <td>Tariq Shah</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP007</td>
                                    <td>Muhammad Sher Khan</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP008</td>
                                    <td>Imran Khan</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP009</td>
                                    <td>Rafeeq Chacha</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                                <tr>
                                    <td>EMP010</td>
                                    <td>Bilal Ahmad</td>
                                    <td>
                                        <select class="form-select form-select-sm attendance-status" onchange="updateStatus(this)">
                                            <option value="">Select Status</option>
                                            <option value="present">Present</option>
                                            <option value="absent">Absent</option>
                                            <option value="leave">Leave</option>
                                            <option value="late">Late</option>
                                        </select>
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-in" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td>
                                        <input type="time" class="form-control form-control-sm check-out" onchange="calculateWorkingHours(this)">
                                    </td>
                                    <td class="working-hours">-</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>

                    <!-- Summary Section -->
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Today's Summary</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total Staff:</span>
                                        <strong>10</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Present:</span>
                                        <strong id="presentCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Absent:</span>
                                        <strong id="absentCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>On Leave:</span>
                                        <strong id="leaveCount">0</strong>
                                    </div>
                                    <div class="d-flex justify-content-between">
                                        <span>Late:</span>
                                        <strong id="lateCount">0</strong>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="card">
                                <div class="card-body">
                                    <h6 class="card-title">Monthly Overview</h6>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Average Attendance Rate:</span>
                                        <strong>95%</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Total Working Days:</span>
                                        <strong>22</strong>
                                    </div>
                                    <div class="d-flex justify-content-between mb-2">
                                        <span>Holidays:</span>
                                        <strong>8</strong>
                                    </div>
                                    <div class="mt-3">
                                        <h6 class="mb-2">Upcoming Holidays:</h6>
                                        <ul class="list-unstyled">
                                            <li class="mb-1">• Eid ul Fitr (3 days)</li>
                                            <li class="mb-1">• Independence Day (14 August)</li>
                                            <li class="mb-1">• Eid ul Adha (4 days)</li>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Notification Container -->
    <div class="notification" id="notificationContainer"></div>

    <!-- Payments Section -->
    <div class="payments-section d-none" id="paymentsSection">
        <div class="section-header d-flex justify-content-between align-items-center mb-4">
            <h2>Payments & Wages</h2>
            <div class="filters d-flex gap-3">
                <select class="form-select" id="paymentType">
                    <option value="all">All Types</option>
                    <option value="labor">Labor Wages</option>
                    <option value="staff">Staff Salary</option>
                </select>
                <select class="form-select" id="paymentStatus">
                    <option value="all">All Status</option>
                    <option value="pending">Pending</option>
                    <option value="paid">Paid</option>
                </select>
                <input type="text" class="form-control" placeholder="Search by Name/ID" id="paymentSearch">
            </div>
        </div>

        <div class="table-responsive">
            <table class="table table-dark table-hover">
                <thead>
                    <tr>
                        <th>Date</th>
                        <th>ID</th>
                        <th>Name</th>
                        <th>Type</th>
                        <th>Amount</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody id="paymentsTableBody">
                    <!-- Payments will be loaded here -->
                </tbody>
            </table>
        </div>

        <!-- Add New Payment Button -->
        <button class="btn btn-success mt-3" onclick="showAddPaymentForm()">
            <i class="fas fa-plus"></i> Add New Payment
        </button>

        <!-- Add Payment Form Modal -->
        <div class="modal fade" id="addPaymentModal">
            <div class="modal-dialog">
                <div class="modal-content bg-dark">
                    <div class="modal-header">
                        <h5 class="modal-title">Add New Payment</h5>
                        <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                    </div>
                    <div class="modal-body">
                        <form id="addPaymentForm">
                            <div class="mb-3">
                                <label class="form-label">Payment Type</label>
                                <select class="form-select" name="type" required>
                                    <option value="labor">Labor Wages</option>
                                    <option value="staff">Staff Salary</option>
                                </select>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Worker/Staff ID</label>
                                <input type="text" class="form-control" name="workerId" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Name</label>
                                <input type="text" class="form-control" name="name" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Amount</label>
                                <input type="number" class="form-control" name="amount" required>
                            </div>
                            <div class="mb-3">
                                <label class="form-label">Payment Date</label>
                                <input type="date" class="form-control" name="date" required>
                            </div>
                            <button type="submit" class="btn btn-primary">Add Payment</button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Scripts -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
        // Show/hide navigation lists
        document.getElementById('warehousesLink').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('warehousesList').classList.toggle('d-none');
            document.getElementById('centersList').classList.add('d-none');
        });

        document.getElementById('centersLink').addEventListener('click', function(e) {
            e.preventDefault();
            document.getElementById('centersList').classList.toggle('d-none');
            document.getElementById('warehousesList').classList.add('d-none');
        });

        // Admin login validation
        function validateLogin() {
            const username = document.getElementById('username').value;
            const password = document.getElementById('password').value;
            const rememberMe = document.getElementById('rememberMe').checked;
            
            const storedPassword = localStorage.getItem('adminPassword') || 'admin123';

            if (username === 'admin' && password === storedPassword) {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
                if (rememberMe) {
                    localStorage.setItem('adminLoggedIn', 'true');
                }
            } else {
                document.getElementById('loginError').classList.remove('d-none');
            }
        }

        // Check if admin is already logged in
        window.onload = function() {
            if (localStorage.getItem('adminLoggedIn') === 'true') {
                document.getElementById('loginForm').style.display = 'none';
                document.getElementById('adminDashboard').style.display = 'block';
            }
        }

        // Show pending registrations modal
        function showPendingRegistrations() {
            loadStaffApplications();
            const modal = new bootstrap.Modal(document.getElementById('pendingRegistrationsModal'));
            modal.show();
        }

        let currentRow = null;
        let isAccepted = false;

        // Accept labor registration
        function acceptLabor(button) {
            currentRow = button.closest('tr');
            const acceptConfirmationModal = new bootstrap.Modal(document.getElementById('acceptConfirmationModal'));
            acceptConfirmationModal.show();

            document.getElementById('confirmAcceptBtn').onclick = function() {
                const name = currentRow.cells[0].textContent;
                
                // Update status
                currentRow.cells[4].innerHTML = '<span class="badge bg-success">Accepted</span>';
                
                // Update actions
                currentRow.cells[5].innerHTML = '<button class="btn btn-info btn-sm" onclick="viewLaborDetails(this)">View Details</button>';
                
                // Update pending counts
                const pendingCount = document.getElementById('pendingCount');
                const dashboardPendingCount = document.getElementById('dashboardPendingCount');
                const newCount = parseInt(pendingCount.textContent) - 1;
                pendingCount.textContent = newCount;
                dashboardPendingCount.textContent = newCount;
                
                // Add to recent activity
                addToRecentActivity(`Labor registration for ${name} has been accepted`);
                
                // Close modals
                acceptConfirmationModal.hide();
                bootstrap.Modal.getInstance(document.getElementById('pendingRegistrationsModal'))?.hide();
                bootstrap.Modal.getInstance(document.getElementById('laborDetailsModal'))?.hide();
                
                // Show success notification
                showNotification('Success', 'Labor registration has been accepted successfully', 'success');

                // Set accepted status
                isAccepted = true;
            };
        }

        // Reject labor registration
        function rejectLabor(button) {
            currentRow = button.closest('tr');
            const rejectConfirmationModal = new bootstrap.Modal(document.getElementById('rejectConfirmationModal'));
            rejectConfirmationModal.show();

            document.getElementById('confirmRejectBtn').onclick = function() {
                const name = currentRow.cells[0].textContent;
                
                // Remove the row
                currentRow.remove();
                
                // Update pending counts
                const pendingCount = document.getElementById('pendingCount');
                const dashboardPendingCount = document.getElementById('dashboardPendingCount');
                const newCount = parseInt(pendingCount.textContent) - 1;
                pendingCount.textContent = newCount;
                dashboardPendingCount.textContent = newCount;
                
                // Add to recent activity
                addToRecentActivity(`Labor registration for ${name} has been rejected`);
                
                // Close modals
                rejectConfirmationModal.hide();
                bootstrap.Modal.getInstance(document.getElementById('pendingRegistrationsModal'))?.hide();
                bootstrap.Modal.getInstance(document.getElementById('laborDetailsModal'))?.hide();
                
                // Show notification
                showNotification('Info', 'Labor registration has been rejected', 'info');
            };
        }

        // Add to recent activity
        function addToRecentActivity(message) {
            const activityList = document.getElementById('recentActivityList');
            const now = new Date();
            const timeString = now.toLocaleTimeString();
            
            const activityItem = document.createElement('div');
            activityItem.className = 'activity-item';
            activityItem.innerHTML = `
                <div class="d-flex justify-content-between align-items-center">
                    <span>${message}</span>
                    <small class="text-muted">${timeString}</small>
                </div>
            `;
            
            activityList.insertBefore(activityItem, activityList.firstChild);
        }

        // Show notification
        function showNotification(title, message, type) {
            const container = document.getElementById('notificationContainer');
            const notification = document.createElement('div');
            notification.className = `alert alert-${type} alert-dismissible fade show`;
            notification.innerHTML = `
                <strong>${title}:</strong> ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            container.appendChild(notification);
            
            // Auto remove after 5 seconds
            setTimeout(() => {
                notification.remove();
            }, 5000);
        }

        // View labor details
        function viewLaborDetails(button) {
            const row = button.closest('tr');
            const name = row.cells[0].textContent;
            const cnic = row.cells[1].textContent;
            const age = row.cells[2].textContent;
            const experience = row.cells[3].textContent;
            const status = row.cells[4].textContent.trim();

            // Demo data - in real app, this would be fetched from database
            document.getElementById('laborName').textContent = name;
            document.getElementById('laborCNIC').textContent = cnic;
            document.getElementById('laborAge').textContent = age;
            document.getElementById('laborGender').textContent = 'Male';
            document.getElementById('laborMaritalStatus').textContent = 'Single';
            document.getElementById('laborEducation').textContent = 'Matriculation';
            document.getElementById('laborExperience').textContent = experience;
            document.getElementById('laborSkills').textContent = 'Tobacco Processing, Hand Stemming';
            document.getElementById('laborPreviousWork').textContent = 'Worked at various tobacco processing facilities';
            document.getElementById('laborLanguages').textContent = 'Urdu, Punjabi';
            document.getElementById('laborHealth').textContent = 'Good';
            document.getElementById('emergencyName').textContent = 'Ahmad Khan';
            document.getElementById('emergencyRelation').textContent = 'Brother';

            // Show/hide accept/reject buttons based on status
            const acceptBtn = document.querySelector('#laborDetailsModal .btn-success');
            const rejectBtn = document.querySelector('#laborDetailsModal .btn-danger');
            
            if (status === 'Accepted') {
                acceptBtn.style.display = 'none';
                rejectBtn.style.display = 'none';
            } else {
                acceptBtn.style.display = 'inline-block';
                rejectBtn.style.display = 'inline-block';
            }

            const detailsModal = new bootstrap.Modal(document.getElementById('laborDetailsModal'));
            detailsModal.show();
        }

        // Show change password modal
        function showChangePassword() {
            const modal = new bootstrap.Modal(document.getElementById('changePasswordModal'));
            // Reset form and errors when opening modal
            document.getElementById('changePasswordForm').reset();
            document.getElementById('passwordError').classList.add('d-none');
            document.getElementById('passwordMismatch').classList.add('d-none');
            modal.show();
        }

        // Toggle password visibility
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = event.currentTarget.querySelector('i');
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Change password function
        function changePassword() {
            const currentPassword = document.getElementById('currentPassword').value;
            const newPassword = document.getElementById('newPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            // Reset error messages
            document.getElementById('passwordError').classList.add('d-none');
            document.getElementById('passwordMismatch').classList.add('d-none');
            
            // Check if current password is correct
            if (currentPassword !== 'admin123') { // This should match your login password
                document.getElementById('passwordError').classList.remove('d-none');
                return;
            }
            
            // Check if new passwords match
            if (newPassword !== confirmPassword) {
                document.getElementById('passwordMismatch').classList.remove('d-none');
                return;
            }
            
            // Update password (in real app, this would be saved to database)
            localStorage.setItem('adminPassword', newPassword);
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('changePasswordModal')).hide();
            
            // Show success notification
            showNotification('Success', 'Password has been changed successfully', 'success');
            
            // Add to recent activity
            addToRecentActivity('Admin password was changed');
        }

        // Show attendance modal
        function showAttendanceModal() {
            const modal = new bootstrap.Modal(document.getElementById('attendanceModal'));
            // Set today's date by default
            document.getElementById('attendanceDate').valueAsDate = new Date();
            loadAttendance();
            modal.show();
        }

        // Load attendance for selected date
        function loadAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const savedData = localStorage.getItem('attendance_' + date);
            
            if (savedData) {
                const attendanceData = JSON.parse(savedData);
                const rows = document.querySelectorAll('#attendanceTableBody tr');
                
                rows.forEach((row, index) => {
                    if (attendanceData[index]) {
                        const data = attendanceData[index];
                        row.querySelector('.attendance-status').value = data.status;
                        row.querySelector('.check-in').value = data.checkIn;
                        row.querySelector('.check-out').value = data.checkOut;
                        row.querySelector('.working-hours').textContent = data.workingHours;
                    }
                });
                
                updateSummary();
                showNotification('Info', 'Loaded attendance data for ' + date, 'info');
            }
        }

        // Mark all staff as present with current time
        function markAllPresent() {
            const rows = document.querySelectorAll('#attendanceTableBody tr');
            rows.forEach(row => {
                const select = row.querySelector('.attendance-status');
                select.value = 'present';
                updateStatus(select);
            });
        }

        // Reset attendance form
        function resetAttendance() {
            const rows = document.querySelectorAll('#attendanceTableBody tr');
            rows.forEach(row => {
                const select = row.querySelector('.attendance-status');
                const checkIn = row.querySelector('.check-in');
                const checkOut = row.querySelector('.check-out');
                const hours = row.querySelector('.working-hours');
                
                select.value = '';
                checkIn.value = '';
                checkOut.value = '';
                hours.textContent = '-';
            });
            updateSummary();
        }

        // Save attendance
        function saveAttendance() {
            const date = document.getElementById('attendanceDate').value;
            const rows = document.querySelectorAll('#attendanceTableBody tr');
            const attendanceData = [];
            
            rows.forEach(row => {
                const empData = {
                    empId: row.cells[0].textContent,
                    name: row.cells[1].textContent,
                    status: row.querySelector('.attendance-status').value,
                    checkIn: row.querySelector('.check-in').value,
                    checkOut: row.querySelector('.check-out').value,
                    workingHours: row.querySelector('.working-hours').textContent
                };
                attendanceData.push(empData);
            });
            
            // Save to localStorage with date as key
            localStorage.setItem('attendance_' + date, JSON.stringify(attendanceData));
            
            // Show success notification
            showNotification('Success', 'Attendance has been saved successfully', 'success');
            addToRecentActivity('Attendance marked for ' + date);
            
            // Close modal
            bootstrap.Modal.getInstance(document.getElementById('attendanceModal')).hide();
        }

        // Update attendance status and set automatic time
        function updateStatus(select) {
            const row = select.closest('tr');
            const checkIn = row.querySelector('.check-in');
            const checkOut = row.querySelector('.check-out');
            const status = select.value;
            
            // Reset times
            checkIn.value = '';
            checkOut.value = '';
            row.querySelector('.working-hours').textContent = '-';
            
            if (status === 'present' || status === 'late') {
                // Get current time
                const now = new Date();
                const currentTime = now.toLocaleTimeString('en-US', { hour12: false }).slice(0, 5);
                
                // Set check-in time
                checkIn.value = currentTime;
                
                // Set check-out time (8 hours later for present, 7 hours for late)
                const outTime = new Date(now.getTime() + (status === 'present' ? 8 : 7) * 60 * 60 * 1000);
                checkOut.value = outTime.toLocaleTimeString('en-US', { hour12: false }).slice(0, 5);
                
                // Calculate working hours
                calculateWorkingHours(checkIn);
            }
            
            updateSummary();
        }

        // Update summary counts
        function updateSummary() {
            const statuses = document.querySelectorAll('.attendance-status');
            let present = 0, absent = 0, leave = 0, late = 0;
            
            statuses.forEach(select => {
                switch(select.value) {
                    case 'present': present++; break;
                    case 'absent': absent++; break;
                    case 'leave': leave++; break;
                    case 'late': late++; break;
                }
            });
            
            document.getElementById('presentCount').textContent = present;
            document.getElementById('absentCount').textContent = absent;
            document.getElementById('leaveCount').textContent = leave;
            document.getElementById('lateCount').textContent = late;
        }

        // Add this function in the script section
        function calculateWorkingHours(input) {
            const row = input.closest('tr');
            const checkIn = row.querySelector('.check-in').value;
            const checkOut = row.querySelector('.check-out').value;
            
            if (checkIn && checkOut) {
                const inTime = new Date('2000-01-01 ' + checkIn);
                const outTime = new Date('2000-01-01 ' + checkOut);
                
                // Calculate difference in hours
                let hours = (outTime - inTime) / (1000 * 60 * 60);
                
                // If checkout is earlier than checkin, add 24 hours
                if (hours < 0) {
                    hours += 24;
                }
                
                // Format to 2 decimal places
                hours = hours.toFixed(2);
                row.querySelector('.working-hours').textContent = hours + ' hrs';
            }
        }

        // Add SheetJS library for Excel export
        document.head.innerHTML += '<script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"><\/script>';

        // Add these functions after existing script
        function loadMonthlyAttendance() {
            const monthYear = document.getElementById('monthSelector').value;
            const [year, month] = monthYear.split('-');
            const daysInMonth = new Date(year, month, 0).getDate();
            
            const tableBody = document.getElementById('monthlyAttendanceBody');
            tableBody.innerHTML = '';
            
            // Store all attendance data for summary calculation
            const attendanceData = [];
            
            // Loop through each day of the month
            for (let day = 1; day <= daysInMonth; day++) {
                const date = `${year}-${month}-${String(day).padStart(2, '0')}`;
                const savedData = localStorage.getItem('attendance_' + date);
                
                if (savedData) {
                    const dayData = JSON.parse(savedData);
                    dayData.forEach(record => {
                        const row = document.createElement('tr');
                        row.innerHTML = `
                            <td>${date}</td>
                            <td>${record.empId}</td>
                            <td>${record.name}</td>
                            <td>${record.status}</td>
                            <td>${record.checkIn}</td>
                            <td>${record.checkOut}</td>
                            <td>${record.workingHours}</td>
                        `;
                        tableBody.appendChild(row);
                        attendanceData.push({...record, date});
                    });
                }
            }
            
            generateMonthlySummary(attendanceData);
        }

        function generateMonthlySummary(data) {
            const summaryContainer = document.getElementById('monthlySummaryContainer');
            summaryContainer.innerHTML = '';
            
            // Group data by employee
            const employeeSummary = {};
            
            data.forEach(record => {
                if (!employeeSummary[record.empId]) {
                    employeeSummary[record.empId] = {
                        name: record.name,
                        present: 0,
                        absent: 0,
                        leave: 0,
                        late: 0,
                        totalHours: 0
                    };
                }
                
                const summary = employeeSummary[record.empId];
                
                // Update status counts
                switch(record.status) {
                    case 'present': summary.present++; break;
                    case 'absent': summary.absent++; break;
                    case 'leave': summary.leave++; break;
                    case 'late': summary.late++; break;
                }
                
                // Add working hours
                if (record.workingHours !== '-') {
                    summary.totalHours += parseFloat(record.workingHours);
                }
            });
            
            // Create summary cards
            Object.entries(employeeSummary).forEach(([empId, summary]) => {
                const col = document.createElement('div');
                col.className = 'col-md-6 col-lg-4 mb-3';
                col.innerHTML = `
                    <div class="card">
                        <div class="card-body">
                            <h6 class="card-title">${summary.name} (${empId})</h6>
                            <div class="row g-2">
                                <div class="col-6">
                                    <small class="text-muted">Present</small>
                                    <div class="fw-bold">${summary.present} days</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Absent</small>
                                    <div class="fw-bold">${summary.absent} days</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Leave</small>
                                    <div class="fw-bold">${summary.leave} days</div>
                                </div>
                                <div class="col-6">
                                    <small class="text-muted">Late</small>
                                    <div class="fw-bold">${summary.late} days</div>
                                </div>
                                <div class="col-12">
                                    <small class="text-muted">Total Working Hours</small>
                                    <div class="fw-bold">${summary.totalHours.toFixed(2)} hrs</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                summaryContainer.appendChild(col);
            });
        }

        function exportToExcel() {
            const table = document.getElementById('monthlyAttendanceTable');
            const month = document.getElementById('monthSelector').value;
            
            try {
                // Create a new workbook
                const wb = XLSX.utils.book_new();
                
                // Convert table to worksheet
                const ws = XLSX.utils.table_to_sheet(table);
                
                // Set column widths
                const columnWidths = [
                    {wch: 12}, // Date
                    {wch: 10}, // Employee ID
                    {wch: 20}, // Name
                    {wch: 10}, // Status
                    {wch: 10}, // Check In
                    {wch: 10}, // Check Out
                    {wch: 12}  // Working Hours
                ];
                ws['!cols'] = columnWidths;
                
                // Add the worksheet to the workbook
                XLSX.utils.book_append_sheet(wb, ws, 'Attendance');
                
                // Save the file
                XLSX.writeFile(wb, `Attendance_${month}.xlsx`);
                
                // Show success notification
                showNotification('Success', 'Attendance data exported to Excel successfully', 'success');
            } catch (error) {
                console.error('Error exporting to Excel:', error);
                showNotification('Error', 'Failed to export attendance data', 'danger');
            }
        }

        // Set current month as default when page loads
        window.addEventListener('load', function() {
            const today = new Date();
            const month = today.getFullYear() + '-' + String(today.getMonth() + 1).padStart(2, '0');
            document.getElementById('monthSelector').value = month;
            loadMonthlyAttendance();
        });

        // Add this new function to scroll to attendance records
        function showAttendanceRecords() {
            // Find all card titles and look for the one containing "Attendance Records"
            const cardTitles = document.querySelectorAll('.card-title');
            let attendanceSection = null;
            
            for (const title of cardTitles) {
                if (title.textContent.includes('Attendance Records')) {
                    attendanceSection = title.closest('.row');
                    break;
                }
            }
            
            if (attendanceSection) {
                attendanceSection.scrollIntoView({ behavior: 'smooth' });
                
                // Highlight the section briefly
                attendanceSection.style.animation = 'none';
                attendanceSection.offsetHeight; // Trigger reflow
                attendanceSection.style.animation = 'highlight 2s';
            }
        }

        // Add CSS animation for highlight effect
        const style = document.createElement('style');
        style.textContent = `
            @keyframes highlight {
                0% { background-color: rgba(42, 82, 152, 0.1); }
                100% { background-color: transparent; }
            }
        `;
        document.head.appendChild(style);

        // Load staff applications
        function loadStaffApplications() {
            const applications = JSON.parse(localStorage.getItem('staffApplications') || '[]');
            const tableBody = document.getElementById('staffApplicationsTable');
            tableBody.innerHTML = '';
            
            applications.forEach((app, index) => {
                if (app.status === 'pending') {
                    const row = document.createElement('tr');
                    row.innerHTML = `
                        <td>${app.fullName}</td>
                        <td>${app.position}</td>
                        <td>${app.education}</td>
                        <td>${app.experience} years</td>
                        <td><span class="badge bg-warning">Pending</span></td>
                        <td>
                            <button class="btn btn-info btn-sm" onclick="viewStaffApplication(${index})">View Details</button>
                            <button class="btn btn-success btn-sm" onclick="acceptStaffApplication(${index})">Accept</button>
                            <button class="btn btn-danger btn-sm" onclick="rejectStaffApplication(${index})">Reject</button>
                        </td>
                    `;
                    tableBody.appendChild(row);
                }
            });
        }

        // View staff application details
        function viewStaffApplication(index) {
            const applications = JSON.parse(localStorage.getItem('staffApplications') || '[]');
            const app = applications[index];
            
            // Fill modal with application details
            document.getElementById('appName').textContent = app.fullName;
            document.getElementById('appCNIC').textContent = app.cnic;
            document.getElementById('appEmail').textContent = app.email;
            document.getElementById('appPhone').textContent = app.phone;
            document.getElementById('appDOB').textContent = app.dob;
            document.getElementById('appGender').textContent = app.gender;
            document.getElementById('appEducation').textContent = app.education;
            document.getElementById('appExperience').textContent = app.experience + ' years';
            document.getElementById('appPosition').textContent = app.position;
            document.getElementById('appSkills').textContent = app.skills;
            document.getElementById('appPreviousEmployer').textContent = app.previousEmployer || 'N/A';
            document.getElementById('appWorkHistory').textContent = app.workHistory || 'N/A';
            document.getElementById('appReferenceName').textContent = app.referenceName || 'N/A';
            document.getElementById('appReferenceContact').textContent = app.referenceContact || 'N/A';
            
            // Store current application index
            document.getElementById('staffApplicationModal').dataset.currentIndex = index;
            
            // Show modal
            const modal = new bootstrap.Modal(document.getElementById('staffApplicationModal'));
            modal.show();
        }

        // Accept staff application
        function acceptStaffApplication(index) {
            const applications = JSON.parse(localStorage.getItem('staffApplications') || '[]');
            const app = applications[index];
            
            // Update application status
            app.status = 'accepted';
            localStorage.setItem('staffApplications', JSON.stringify(applications));
            
            // Add to recent activity
            addToRecentActivity(`Staff application for ${app.fullName} has been accepted`);
            
            // Show notification
            showNotification('Success', 'Staff application has been accepted successfully', 'success');
            
            // Reload applications table
            loadStaffApplications();
            
            // Close modal if open
            bootstrap.Modal.getInstance(document.getElementById('staffApplicationModal'))?.hide();
        }

        // Reject staff application
        function rejectStaffApplication(index) {
            const applications = JSON.parse(localStorage.getItem('staffApplications') || '[]');
            const app = applications[index];
            
            // Update application status
            app.status = 'rejected';
            localStorage.setItem('staffApplications', JSON.stringify(applications));
            
            // Add to recent activity
            addToRecentActivity(`Staff application for ${app.fullName} has been rejected`);
            
            // Show notification
            showNotification('Info', 'Staff application has been rejected', 'info');
            
            // Reload applications table
            loadStaffApplications();
            
            // Close modal if open
            bootstrap.Modal.getInstance(document.getElementById('staffApplicationModal'))?.hide();
        }

        // Show registrations section
        function showRegistrations() {
            // Hide other sections if needed
            document.getElementById('registrationsSection').classList.remove('d-none');
            loadRegistrations();
        }

        // Load all registrations
        function loadRegistrations() {
            const tableBody = document.getElementById('registrationsTableBody');
            const type = document.getElementById('registrationType').value;
            const status = document.getElementById('registrationStatus').value;
            const search = document.getElementById('searchRegistrations').value.toLowerCase();
            
            // Clear table
            tableBody.innerHTML = '';
            
            // Load labor registrations
            const laborRegistrations = JSON.parse(localStorage.getItem('laborRegistrations') || '[]');
            const staffApplications = JSON.parse(localStorage.getItem('staffApplications') || '[]');
            
            // Combine and sort by date
            const allRegistrations = [
                ...laborRegistrations.map(reg => ({...reg, type: 'labor'})),
                ...staffApplications.map(app => ({...app, type: 'staff'}))
            ].sort((a, b) => new Date(b.applicationDate) - new Date(a.applicationDate));
            
            allRegistrations.forEach(reg => {
                // Apply filters
                if (type !== 'all' && reg.type !== type) return;
                if (status !== 'all' && reg.status !== status) return;
                if (search && !reg.fullName.toLowerCase().includes(search)) return;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${new Date(reg.applicationDate).toLocaleDateString()}</td>
                    <td>${reg.fullName}</td>
                    <td>${reg.type === 'labor' ? 'Labor' : 'Staff'}</td>
                    <td>${reg.cnic}</td>
                    <td><span class="badge bg-${getStatusBadgeClass(reg.status)}">${reg.status}</span></td>
                    <td>
                        <button class="btn btn-info btn-sm" onclick="viewRegistrationDetails('${reg.type}', ${reg.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Get badge class based on status
        function getStatusBadgeClass(status) {
            switch(status) {
                case 'pending': return 'warning';
                case 'accepted': return 'success';
                case 'rejected': return 'danger';
                default: return 'secondary';
            }
        }

        // Add event listeners for filters
        document.getElementById('registrationType').addEventListener('change', loadRegistrations);
        document.getElementById('registrationStatus').addEventListener('change', loadRegistrations);
        document.getElementById('searchRegistrations').addEventListener('input', loadRegistrations);

        // Add these functions to your existing JavaScript
        function showPayments() {
            // Hide other sections
            document.querySelectorAll('.registrations-section, .dashboard-section').forEach(section => {
                section.classList.add('d-none');
            });
            
            // Show payments section
            document.getElementById('paymentsSection').classList.remove('d-none');
            
            // Load payments data
            loadPayments();
        }

        function loadPayments() {
            // Get payments from localStorage
            const payments = JSON.parse(localStorage.getItem('payments')) || [];
            const tableBody = document.getElementById('paymentsTableBody');
            const paymentType = document.getElementById('paymentType').value;
            const paymentStatus = document.getElementById('paymentStatus').value;
            const searchTerm = document.getElementById('paymentSearch').value.toLowerCase();
            
            // Filter payments based on selected filters
            const filteredPayments = payments.filter(payment => {
                const matchesType = paymentType === 'all' || payment.type === paymentType;
                const matchesStatus = paymentStatus === 'all' || payment.status === paymentStatus;
                const matchesSearch = payment.name.toLowerCase().includes(searchTerm) || 
                                    payment.id.toLowerCase().includes(searchTerm);
                
                return matchesType && matchesStatus && matchesSearch;
            });
            
            // Clear existing table rows
            tableBody.innerHTML = '';
            
            // Add filtered payments to table
            filteredPayments.forEach(payment => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${payment.date}</td>
                    <td>${payment.id}</td>
                    <td>${payment.name}</td>
                    <td>${payment.type === 'labor' ? 'Labor Wages' : 'Staff Salary'}</td>
                    <td>Rs. ${payment.amount}</td>
                    <td>
                        <span class="badge ${payment.status === 'paid' ? 'bg-success' : 'bg-warning'}">
                            ${payment.status}
                        </span>
                    </td>
                    <td>
                        <button class="btn btn-sm btn-primary" onclick="markAsPaid('${payment.id}')">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="btn btn-sm btn-danger" onclick="deletePayment('${payment.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function showAddPaymentForm() {
            const modal = new bootstrap.Modal(document.getElementById('addPaymentModal'));
            modal.show();
        }

        function handleAddPayment(event) {
            event.preventDefault();
            
            const form = event.target;
            const formData = new FormData(form);
            
            // Create payment object
            const payment = {
                id: 'PAY-' + Date.now(),
                type: formData.get('type'),
                workerId: formData.get('workerId'),
                name: formData.get('name'),
                amount: formData.get('amount'),
                date: formData.get('date'),
                status: 'pending'
            };
            
            // Get existing payments
            const payments = JSON.parse(localStorage.getItem('payments')) || [];
            
            // Add new payment
            payments.push(payment);
            
            // Save to localStorage
            localStorage.setItem('payments', JSON.stringify(payments));
            
            // Close modal and reload payments
            bootstrap.Modal.getInstance(document.getElementById('addPaymentModal')).hide();
            loadPayments();
            
            // Show success message
            alert('Payment added successfully!');
        }

        function markAsPaid(paymentId) {
            const payments = JSON.parse(localStorage.getItem('payments')) || [];
            const paymentIndex = payments.findIndex(p => p.id === paymentId);
            
            if (paymentIndex !== -1) {
                payments[paymentIndex].status = 'paid';
                localStorage.setItem('payments', JSON.stringify(payments));
                loadPayments();
            }
        }

        function deletePayment(paymentId) {
            if (confirm('Are you sure you want to delete this payment?')) {
                const payments = JSON.parse(localStorage.getItem('payments')) || [];
                const filteredPayments = payments.filter(p => p.id !== paymentId);
                localStorage.setItem('payments', JSON.stringify(filteredPayments));
                loadPayments();
            }
        }

        // Add event listeners
        document.getElementById('addPaymentForm').addEventListener('submit', handleAddPayment);
        document.getElementById('paymentType').addEventListener('change', loadPayments);
        document.getElementById('paymentStatus').addEventListener('change', loadPayments);
        document.getElementById('paymentSearch').addEventListener('input', loadPayments);
    </script>
</body>
</html>